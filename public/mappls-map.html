<!DOCTYPE html>
<html>
<head>
    <title>Xploraa - Mappls Map</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    <style>
        html,
        body,
        #map {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .btn {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: transform 0.2s;
        }
        
        .btn:hover {
            transform: scale(1.05);
        }
        
        .stats {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            z-index: 1000;
            backdrop-filter: blur(10px);
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .marker {
            animation: pulse 2s infinite;
        }


        /* Minimal status badge */
        .status {
            position: absolute;
            left: 12px;
            top: 12px;
            z-index: 12;
            background: rgba(255,255,255,0.95);
            padding: 6px 10px;
            border-radius: 8px;
            font-weight: 600;
            color: #374151;
            font-family: Inter, ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
        }
    </style>
    <script src="https://apis.mappls.com/advancedmaps/api/b8a5269c-04a7-42cf-8501-3b1371f1ed73/map_sdk?layer=vector&v=3.0&callback=initMap1" defer async></script>
</head>
<body>
    <div id="map"></div>
    
    <!-- Stats -->
    <div class="stats">
        <div style="font-weight: bold; margin-bottom: 8px;">ðŸŽ® Game Stats</div>
        <div style="font-size: 14px; color: #6b7280;">
            XP: <span style="color: #3b82f6; font-weight: bold;">1250</span><br>
            Places Visited: <span style="color: #10b981; font-weight: bold;">12</span><br>
            Level: <span style="color: #f59e0b; font-weight: bold;">5</span>
        </div>
    </div>

    <script>
        var map;
        var markers = [];
        
        // Initialize map after getting current position to avoid default center
        function initMap1() {
            console.log('ðŸš€ Initializing Mappls Map and requesting current position...');
            const statusEl = document.getElementById('status');
            if (statusEl) statusEl.textContent = 'Requesting location...';

            if (!navigator.geolocation) {
                if (statusEl) {
                    statusEl.textContent = 'Geolocation not supported';
                    statusEl.style.color = '#ef4444';
                }
                return;
            }

            navigator.geolocation.getCurrentPosition(function(position) {
                const lat = position.coords.latitude;
                const lng = position.coords.longitude;
                console.log('ðŸ“ Current position:', lat, lng);
                if (statusEl) {
                    statusEl.textContent = `Location: ${lat.toFixed(4)}, ${lng.toFixed(4)}`;
                    statusEl.style.color = '#10b981';
                }

                // create the map centered on the real user location
                map = new mappls.Map('map', {
                    center: [lng, lat],
                    zoom: 16,
                    zoomControl: true,
                    geolocation: false
                });

            }, function(error) {
                console.error('Geolocation error:', error);
                if (statusEl) {
                    statusEl.textContent = 'Unable to get location';
                    statusEl.style.color = '#ef4444';
                }
            }, { enableHighAccuracy: true, timeout: 15000 });
        }
        
        // Control functions
        function zoomIn() {
            if (map) {
                map.setZoom(map.getZoom() + 1);
            }
        }
        
        function zoomOut() {
            if (map) {
                map.setZoom(map.getZoom() - 1);
            }
        }
        
        function addMarkers() {
            if (!map) return;
            
            console.log('ðŸ“ Adding place markers...');
            
            // Sample Delhi places with slight coordinate variations around the center
            const places = [
                { name: 'Red Fort', lat: 28.6562, lng: 77.2410, xp: 100, type: 'historic' },
                { name: 'India Gate', lat: 28.6129, lng: 77.2295, xp: 150, type: 'historic' },
                { name: 'Lotus Temple', lat: 28.5535, lng: 77.2588, xp: 80, type: 'temple' },
                { name: 'Qutub Minar', lat: 28.5244, lng: 77.1855, xp: 120, type: 'historic' },
                { name: 'Connaught Place', lat: 28.6315, lng: 77.2167, xp: 200, type: 'food' },
                { name: 'Chandni Chowk', lat: 28.6506, lng: 77.2301, xp: 180, type: 'food' }
            ];
            
            places.forEach((place, index) => {
                setTimeout(() => {
                    addMarkerAt(place.lng, place.lat, place.name, `Visit ${place.name} and earn ${place.xp} XP!`, place.type);
                }, index * 500); // Staggered animation
            });
        }
        
        function addMarkerAt(lng, lat, title, description, type = 'default') {
            if (!map) return;
            
            // Create marker with custom styling
            const marker = new mappls.Marker({
                map: map,
                position: { lat: lat, lng: lng },
                icon_url: getMarkerIcon(type),
                width: 40,
                height: 40,
                fitbounds: false
            });
            
            // Add info window
            const infoWindow = new mappls.InfoWindow({
                map: map,
                position: { lat: lat, lng: lng },
                content: `
                    <div style="padding: 15px; min-width: 200px; text-align: center;">
                        <h3 style="margin: 0 0 10px 0; color: #1f2937; font-weight: bold;">${title}</h3>
                        <p style="margin: 0 0 15px 0; color: #6b7280; font-size: 14px;">${description}</p>
                        <button onclick="visitPlace('${title}')" style="
                            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
                            color: white;
                            border: none;
                            padding: 8px 16px;
                            border-radius: 6px;
                            cursor: pointer;
                            font-weight: 500;
                        ">ðŸŽ¯ Visit Place</button>
                    </div>
                `
            });
            
            // Add click event to marker
            marker.on('click', function() {
                infoWindow.open();
            });
            
            markers.push(marker);
            console.log(`âœ… Added marker for: ${title}`);
        }
        
        function getMarkerIcon(type) {
            const icons = {
                historic: 'https://apis.mapmyindia.com/map_v3/1.3/png?marker=8b5cf6|15&=',
                museum: 'https://apis.mapmyindia.com/map_v3/1.3/png?marker=3b82f6|15&=',
                temple: 'https://apis.mapmyindia.com/map_v3/1.3/png?marker=f59e0b|15&=',
                food: 'https://apis.mapmyindia.com/map_v3/1.3/png?marker=10b981|15&=',
                default: 'https://apis.mapmyindia.com/map_v3/1.3/png?marker=ef4444|15&='
            };
            return icons[type] || icons.default;
        }
        
        function visitPlace(placeName) {
            alert(`ðŸŽ‰ Congratulations! You visited ${placeName}!\n\n+100 XP earned!\nðŸŽ Special coupon unlocked!`);
            console.log(`ðŸŽ¯ Player visited: ${placeName}`);
        }
        
        function getUserLocation() {
            if (!navigator.geolocation) {
                alert('Geolocation is not supported by this browser.');
                return;
            }
            
            console.log('ðŸ“ Getting user location...');
            
            navigator.geolocation.getCurrentPosition(
                function(position) {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    
                    console.log(`ðŸ“ User location: ${lat}, ${lng}`);
                    
                    // Update map center to user's current location
                    if (map) {
                        map.setCenter([lng, lat]);
                        map.setZoom(16);
                    }
                    
                    // Do not add a large animated/person marker on startup per user request.
                    // Keep map centered on user's real location only.
                    document.getElementById('status').textContent = 'Centered on your location!';
                    document.getElementById('status').style.color = '#10b981';
                },
                function(error) {
                    console.error('Geolocation error:', error);
                    alert('Unable to get your location. Please enable location services.');
                    
                    // Update status
                    document.getElementById('status').textContent = 'Location access denied';
                    document.getElementById('status').style.color = '#ef4444';
                }
            );
        }
        








        
        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ðŸŽ® Xploraa Map Ready!');
            
            // Auto-create character after 5 seconds
            setTimeout(() => {
            }, 5000);
        // Animated character removed to keep map clean and centered on user's real location.
        });
    </script>
</body>
</html>
